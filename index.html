<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­å®ˆè­·ä¸­å¿ƒ - æ˜“è®€ç‰ˆ</title>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.16.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-blue: #7fb3d5; --warm-bg: #fdf5e6; --card-white: #ffffff;
            --text-brown: #5d4037; --accent-orange: #ff8a65; --delete-red: #e57373;
            --save-green: #66bb6a; --history-gold: #d4a373;
        }
        /* å­—é«”å…¨é¢æ”¾å¤§ */
        body, html { height: 100%; margin: 0; font-family: "Microsoft JhengHei", sans-serif; background-color: var(--warm-bg); color: var(--text-brown); font-size: 1.2rem; }
        
        .main-wrapper { display: flex; height: 100vh; padding: 15px; box-sizing: border-box; gap: 15px; }
        
        /* è¨è«–å€ä½”æ“šä¸»è¦å·¦é‚Š 70% */
        .left-panel { flex: 7; display: flex; flex-direction: column; height: 100%; overflow: hidden; }
        /* æª”æ¡ˆèˆ‡æ­·å²ç¸®å°è‡³å³é‚Š 30% */
        .right-panel { flex: 3; display: flex; flex-direction: column; gap: 15px; height: 100%; overflow-y: auto; }

        .nav-container { display: flex; gap: 10px; margin-bottom: 10px; }
        .nav-btn { flex: 1; padding: 12px; border: none; border-radius: 15px; cursor: pointer; background: white; color: var(--primary-blue); font-weight: bold; font-size: 1.3rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .nav-btn.active { background: var(--primary-blue); color: white; }

        .chat-section { background: white; border-radius: 20px; padding: 20px; flex: 1; display: flex; flex-direction: column; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .chat-box { flex: 1; overflow-y: auto; background: #fafafa; border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #eee; }
        
        /* å°è©±æ¨£å¼ï¼šåŠ å¤§å­—é«”ï¼Œç§»é™¤å¤šé¤˜æŒ‰éˆ• */
        .chat-item { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #eee; line-height: 1.6; }
        .chat-user { font-weight: bold; color: var(--primary-blue); font-size: 1.1rem; }
        .chat-text { font-size: 1.4rem; display: block; margin-top: 5px; }

        .input-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        input, select { padding: 15px; border: 1px solid #ddd; border-radius: 12px; font-size: 1.2rem; }
        .btn { border: none; border-radius: 15px; cursor: pointer; font-weight: bold; padding: 12px 20px; font-size: 1.1rem; }
        .btn-primary { background: var(--accent-orange); color: white; }
        
        .mic-btn { background: #4caf50; color: white; width: 60px; height: 60px; border-radius: 50%; font-size: 1.8rem; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .recording { background: #f44336; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        .side-card { background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        h3 { margin-top: 0; font-size: 1.1rem; color: var(--history-gold); border-bottom: 2px solid var(--history-gold); padding-bottom: 5px; }
        
        /* æª”æ¡ˆç®¡ç†å€ */
        .file-item { background: #eef; padding: 8px; margin-top: 5px; border-radius: 8px; font-size: 1rem; display: flex; justify-content: space-between; }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="left-panel">
            <div class="nav-container">
                <button class="nav-btn active" onclick="showTab('papa')">çˆ¸çˆ¸</button>
                <button class="nav-btn" onclick="showTab('mama')">åª½åª½</button>
                <button class="nav-btn" onclick="showTab('worker')">å¤–å‹</button>
            </div>
            
            <div id="tab-content-area" class="chat-section">
                <div id="chat-display" class="chat-box"></div>
                <div class="input-row">
                    <select id="user-select" style="width: 120px;"></select>
                    <button class="mic-btn" id="mic-btn" onclick="startVoice()">ğŸ¤</button>
                    <input type="text" id="msg-input" placeholder="èªªé»ä»€éº¼..." style="flex:1">
                    <button class="btn btn-primary" onclick="sendMessage()">é€å‡º</button>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="side-card">
                <h3>ğŸ“‚ æª”æ¡ˆå‚³é€å€</h3>
                <input type="file" id="file-input" style="width: 100%; font-size: 0.9rem;">
                <button class="btn btn-primary" style="width: 100%; margin-top:10px; background: var(--save-green);" onclick="uploadFile()">ç¢ºèªä¸Šå‚³</button>
                <div id="file-display"></div>
            </div>
            
            <div class="side-card">
                <h3>ğŸ¥ å¥åº·æŒ‡æ¨™</h3>
                <div id="health-display" style="font-size: 1rem;"></div>
            </div>

            <div class="side-card" style="flex: 1; overflow-y: auto;">
                <h3>ğŸ“¦ å·²æ‰“åŒ…æ­·å²</h3>
                <div id="history-display" style="font-size: 0.9rem;"></div>
            </div>
        </div>
    </div>

    <script>
        // --- Firebase é…ç½® (å»¶ç”¨æ‚¨çš„é‡‘é‘°) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDuO2yT2EGDb5llq9dLWE0VWHaSpzBEuvE",
            authDomain: "my-family-thing.firebaseapp.com",
            databaseURL: "https://my-family-thing-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "my-family-thing",
            storageBucket: "my-family-thing.firebasestorage.app",
            messagingSenderId: "8876302942",
            appId: "1:8876302942:web:43ae95b30c0b558d32cacf"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let currentTab = 'papa';
        const family = ['å¨œå§', 'é˜¿ç‘‹', 'é˜¿è‡³', 'å°å¥‡'];

        function init() {
            showTab('papa');
        }

        function showTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event?.currentTarget?.classList?.add('active') || document.querySelector(`button[onclick="showTab('${tab}')"]`).classList.add('active');
            
            // æ›´æ–°ä¸‹æ‹‰é¸å–®
            const userSelect = document.getElementById('user-select');
            userSelect.innerHTML = family.map(f => `<option>${f}</option>`).join('') + (tab === 'worker' ? '<option>Worker</option>' : '');

            // ç›£è½è©²åˆ†é è³‡æ–™
            listenFirebase();
        }

        function listenFirebase() {
            // ç›£è½å°è©± (å–æ¶ˆå­˜æ­·å²/åˆªé™¤æŒ‰éˆ•ï¼Œç´”é¡¯ç¤º)
            db.ref(`${currentTab}/chat`).on('value', snap => {
                const data = snap.val() || {};
                const html = Object.keys(data).map(key => `
                    <div class="chat-item">
                        <span class="chat-user">${data[key].u} <small style="color:#999; font-weight:normal;">${data[key].time.split(' ')[1]}</small></span>
                        <span class="chat-text">${data[key].txt}</span>
                    </div>
                `).join('');
                const box = document.getElementById('chat-display');
                box.innerHTML = html;
                box.scrollTop = box.scrollHeight;
            });

            // ç›£è½æª”æ¡ˆ
            db.ref(`${currentTab}/file`).on('value', snap => {
                const data = snap.val() || {};
                document.getElementById('file-display').innerHTML = Object.keys(data).map(key => `
                    <div class="file-item">ğŸ“„ ${data[key].name} <button onclick="delData('${currentTab}/file/${key}')" style="border:none; background:none; cursor:pointer;">âŒ</button></div>
                `).join('');
            });
        }

        function sendMessage() {
            const txt = document.getElementById('msg-input').value;
            const u = document.getElementById('user-select').value;
            if(!txt) return;
            db.ref(`${currentTab}/chat`).push({ u, txt, time: new Date().toLocaleString() });
            document.getElementById('msg-input').value = '';
        }

        function uploadFile() {
            const f = document.getElementById('file-input').files[0];
            if(f) db.ref(`${currentTab}/file`).push({ name: f.name, time: new Date().toLocaleString() });
        }

        function startVoice() {
            const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
            if(!Speech) return alert('ä¸æ”¯æ´èªéŸ³');
            const rec = new Speech(); rec.lang = 'zh-TW';
            rec.onstart = () => document.getElementById('mic-btn').classList.add('recording');
            rec.onend = () => document.getElementById('mic-btn').classList.remove('recording');
            rec.onresult = (e) => document.getElementById('msg-input').value = e.results[0][0].transcript;
            rec.start();
        }

        function delData(path) { if(confirm('ç¢ºå®šåˆªé™¤æª”æ¡ˆï¼Ÿ')) db.ref(path).remove(); }
        
        init();
    </script>
</body>
</html>
